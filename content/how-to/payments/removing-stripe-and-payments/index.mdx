---
title: How to remove Stripe and payments
sidebarTitle: Remove Stripe
description:
  In some cases, you might want to remove Stripe integrations or even
  all the payments from Sharetribe Web Template. This article gives you
  a starting point for these customizations.
---

import { Callout, FileTree } from 'nextra/components';
import { Steps } from 'nextra/components';

# How to remove Stripe and payments

In this guide, we will go through the minimum changes needed to make the
booking flow work without Stripe. This is not an easy customization
project.

## Removing Stripe

The Sharetribe Web Template works with specific transaction processes
and payments are a core feature of the booking, purchase, and
negotiation processes: the ubiquitous nature means that you need to
touch several components and files. When you remove Stripe payments, you
may need to customize some parts (e.g. transaction process, email
templates, checkout page) more depending on your marketplace idea. For
example, you might also want to remove unused Stripe components from
your project to clean up the code.

<Callout type="info">

The template supports the _default-inquiry_ process, which does not
include bookings or stock reservations. This process is the easiest way
to use a marketplace without Stripe. However, if you do want to use
bookings, stock reservations, or negotiation without Stripe, you will
need to follow the steps in this guide.

</Callout>

To follow these instructions, the transaction process you are modifying
needs to **already exist in your marketplace**.

If you want to add a new transaction process without Stripe actions (for
example `default-booking-no-stripe/release-1`) instead of making a new
version of your existing one (for example `default-booking/release-1`),
you first need to add an unmodified version of it to your marketplace by
following these instructions:

- [Create a new transaction process with the Sharetribe CLI](/how-to/transaction-process/create-new-transaction-process-with-cli/)
- [Change transaction process in Sharetribe Web Template](/how-to/transaction-process/change-transaction-process-in-template/)

<Steps>

### Update the transaction processes and remove Stripe related actions

You need to remove at least the following actions:

- `:action/stripe-create-payment-intent`
- `:action/stripe-capture-payment-intent`
- `:action/stripe-confirm-payment-intent`
- `:action/stripe-create-payout`
- `:action/stripe-refund-charge`
- `:action/stripe-refund-payment`

If you are using the template default processes with strong customer
authentication (e.g. `default-booking`, `default-purchase`,
`default-negotiation`) you need to remove confirming the payment.
Otherwise, the transaction will get stuck. The simplest way to do this
is to remove `pending-payment` and `expire-payment` states and point
`request-payment` and `request-payment-after-inquiry`, or
`request-payment-to-accept-offer`, directly to the following state:

- `preauthorized` in `default-booking`
- `purchased` in `default-purchase`
- `offer-accepted` in `default-negotiation`

When you are building the transaction process for your marketplace, it
may make sense to rename some of the states and transitions so that they
make more sense in your use-case. For instance, _preauthorized_ state
refers to the state of payment - it is preauthorized to be captured.
Without payments in the process, it can be a good idea to change the
state name to something else.

This guide proceeds with the assumption that you have not changed state
and transition names in your process. If you do change your transition
and state names, you will need to double check all example code and
files to make sure you have updated the transition and state names
referenced in those files.

### Edit the transaction process file to reflect the changes in your transaction process

The
[src/transactions/transaction.js](https://github.com/sharetribe/web-template/blob/main/src/transactions/transaction.js)
has a number of helper functions that are used to determine which state
the transaction is. Depending on the transaction process being used, the
_transaction.js_ file refers to either
_src/transactions/transactionProcessBooking.js_,
_src/transactions/transactionProcessPurchase.js_ or
_src/transactions/transactionProcessNegotiation.js_ for the correct
states in each process. The transaction process file should be updated
to match the new transaction process.
[Read more about editing transaction related files](/how-to/transaction-process/change-transaction-process-in-template/#update-the-relevant-files-in-srctransactions-folder).

Example:

```diff filename="transactionProcessBooking.js"
     [STATE_INITIAL]: {
       on: {
         [TRANSITION_INQUIRE]: STATE_INQUIRY,
-        [TRANSITION_REQUEST_PAYMENT]: STATE_PENDING_PAYMENT,
+        [TRANSITION_REQUEST_PAYMENT]: STATE_PREAUTHORIZED,
       },
     },
     [STATE_INQUIRY]: {
       on: {
-        [TRANSITION_REQUEST_PAYMENT_AFTER_INQUIRY]: STATE_PENDING_PAYMENT,
+        [TRANSITION_REQUEST_PAYMENT_AFTER_INQUIRY]: STATE_PREAUTHORIZED,
       },
     },
-
-    [STATE_PENDING_PAYMENT]: {
-      on: {
-        [TRANSITION_EXPIRE_PAYMENT]: STATE_PAYMENT_EXPIRED,
-        [TRANSITION_CONFIRM_PAYMENT]: STATE_PREAUTHORIZED,
-      },
-    },
-
-    [STATE_PAYMENT_EXPIRED]: {},
     [STATE_PREAUTHORIZED]: {
       on: {
         [TRANSITION_DECLINE]: STATE_DECLINED,

```

### Remove Stripe checks from EditListingWizard handlePublishListing function

In
[`EditListingWizard.js`](https://github.com/sharetribe/web-template/blob/main/src/containers/EditListingPage/EditListingWizard/EditListingWizard.js)
we check if a provider has a Stripe account with all the required
information before we allow them to publish listings.

<FileTree>
  <FileTree.Folder name="src" defaultOpen>
    <FileTree.Folder name="containers" defaultOpen>
      <FileTree.Folder name="EditListingPage" defaultOpen>
        <FileTree.Folder name="EditListingWizard" defaultOpen>
          <FileTree.File name="EditListingWizard.js" />
        </FileTree.Folder>
      </FileTree.Folder>
    </FileTree.Folder>
  </FileTree.Folder>
</FileTree>

This check is done in the `handlePublishListing` function. If you are
removing all Stripe functionality from your marketplace, you can
simplify the whole function like this, and remove the unused code.

```js filename="EditListingWizard.js"
  handlePublishListing(id) {
    this.props.onPublishListingDraft(id);
  }
```

If you are adding an option to not use Stripe, for example a listing
type where you handle payments outside the Sharetribe transaction
process, you can instead add a new variable such as `isNoStripeProcess`
and use it to bypass the Stripe requirement while keeping it for other
listing types.

```diff filename="EditListingWizard.js"
handlePublishListing(id) {
    const { onPublishListingDraft, currentUser, stripeAccount, listing, config } = this.props;
    const processName = listing?.attributes?.publicData?.transactionProcessAlias.split('/')[0];
    const isInquiryProcess = processName === INQUIRY_PROCESS_NAME;
+   const isNoStripeProcess = processName === BOOKING_NO_STRIPE_PROCESS_NAME;

    ...

    if (
      isInquiryProcess ||
+     isNoStripeProcess ||
      !isPayoutDetailsRequired ||
      (stripeConnected && !stripeRequirementsMissing)
    ) {
      onPublishListingDraft(id);
    } else {
      this.setState({
        draftId: id,
        showPayoutDetails: true,
      });
    }
  }

```

After changing the `handlePublishListing` you can remove unused code.
You also might want to clean up `EditListingPage` and remove the Stripe
related props we pass to `EditListingWizard`.

### Remove Stripe checks from ListingPageCarousel and ListingPageCoverPhoto

The listing page components show a warning to listing authors if they
need to add their Stripe payout details to start accepting orders. With
a non-Stripe listing type, this logic needs to be modified in both
files.

<FileTree>
  <FileTree.Folder name="src" defaultOpen>
    <FileTree.Folder name="containers" defaultOpen>
      <FileTree.Folder name="ListingPage" defaultOpen>
        <FileTree.File name="ListingPageCarousel.js" />
        <FileTree.File name="ListingPageCoverPhoto.js" />
      </FileTree.Folder>
    </FileTree.Folder>
  </FileTree.Folder>
</FileTree>

```diff filename="ListingPageCarousel.js"
+ const isNoStripeProcess = processName === BOOKING_NO_STRIPE_PROCESS_NAME;
  const currentAuthor = authorAvailable ? currentListing.author : null;
  const ensuredAuthor = ensureUser(currentAuthor);
  const authorNeedsPayoutDetails =
-   ['booking', 'purchase'].includes(processType) || (isNegotiation && unitType === OFFER);
+   (!isNoStripeProcess && ['booking', 'purchase'].includes(processType)) ||
+   (isNegotiation && unitType === OFFER);
  const noPayoutDetailsSetWithOwnListing =
    isOwnListing && (authorNeedsPayoutDetails && !currentUser?.attributes?.stripeConnected);
  const payoutDetailsWarning = noPayoutDetailsSetWithOwnListing ? (
    <span className={css.payoutDetailsWarning}>
      <FormattedMessage id="ListingPage.payoutDetailsWarning" values={{ processType }} />
      <NamedLink name="StripePayoutPage">
        <FormattedMessage id="ListingPage.payoutDetailsWarningLink" />
      </NamedLink>
    </span>
  ) : null;
```

### Remove Stripe checks from MakeOfferForm

If you are fully removing Stripe, or if you are removing Stripe payments
from a process that is based on `default-negotiation`, you also need to
modify the
[MakeOfferForm.js](https://github.com/sharetribe/web-template/blob/main/src/containers/MakeOfferPage/MakeOfferForm/MakeOfferForm.js).

<FileTree>
  <FileTree.Folder name="src" defaultOpen>
    <FileTree.Folder name="containers" defaultOpen>
      <FileTree.Folder name="MakeOfferPage" defaultOpen>
        <FileTree.Folder name="MakeOfferForm" defaultOpen>
          <FileTree.File name="MakeOfferForm.js" />
        </FileTree.Folder>
      </FileTree.Folder>
    </FileTree.Folder>
  </FileTree.Folder>
</FileTree>

This component has a limitation that providers cannot submit their offer
if they don't have a Stripe account. You will need to remove the
references to `stripeConnected` in the form to remove this restriction.

### Edit CheckoutPage

Removing Stripe from `CheckoutPage` is probably the most complicated
task in this list because the Strong Customer Authentication (SCA) and
ability to save payment method have added a lot of logic to the current
page.

By default, the `CheckoutPage` component uses two sub-components,
depending on the transaction process:

- _CheckoutPageWithInquiryProcess_ is used with the default free inquiry
  process
- _CheckoutPageWithPayment_ is used with the default booking and
  purchase processes

We can use an edited version of the _CheckoutPageWithPayment_ component,
titled _CheckoutPageWithoutPayment_, as a starting point for the
modifications.

- [CheckoutPageWithoutPayment.js](/resources/cookbook-assets/CheckoutPageWithoutPayment.js)

The `CheckoutPageWithoutPayment.js` component uses the default
transition variables REQUEST_PAYMENT and REQUEST_PAYMENT_AFTER_INQUIRY
in the `fetchSpeculatedTransactionIfNeeded` function, so if you have
edited your transition names, double check that this function calls the
right transitions.

The _CheckoutPageWithoutPayment_ component also imports a
_SimpleOrderForm_ component. Let's add the component to the existing
StripePaymentForm folder.

<FileTree>
  <FileTree.Folder name="src" defaultOpen>
    <FileTree.Folder name="containers" defaultOpen>
      <FileTree.Folder name="CheckoutPage" defaultOpen>
        <FileTree.Folder name="StripePaymentForm" defaultOpen>
          <FileTree.File name="SimpleOrderForm.js" />
        </FileTree.Folder>
      </FileTree.Folder>
    </FileTree.Folder>
  </FileTree.Folder>
</FileTree>

- [SimpleOrderForm.js](/resources/cookbook-assets/SimpleOrderForm.js)

If you are removing Stripe entirely, you can replace the
`CheckoutPageWithPayment` component with the
`CheckoutPageWithoutPayment` one on CheckoutPage.js.

If you are adding a separate transaction process that works without
Stripe, you will need to add the `CheckoutPageWithoutPayment` to the
CheckoutPage `return` statement to take it into use.

```diff filename="CheckoutPage.js"
+ const isNoStripeProcess = processName === BOOKING_NO_STRIPE_PROCESS_NAME;

  return processName && isInquiryProcess ? (
    <CheckoutPageWithInquiryProcess
      config={config}
      routeConfiguration={routeConfiguration}
      intl={intl}
      history={history}
      processName={processName}
      pageData={pageData}
      listingTitle={listingTitle}
      title={title}
      onInquiryWithoutPayment={onInquiryWithoutPayment}
      onSubmitCallback={onSubmitCallback}
      showListingImage={showListingImage}
      {...props}
    />
+ ) : processName && isNoStripeProcess && !speculateTransactionInProgress ? (
+   <CheckoutPageWithoutPayment
+     config={config}
+     routeConfiguration={routeConfiguration}
+     intl={intl}
+     history={history}
+     processName={processName}
+     sessionStorageKey={STORAGE_KEY}
+     pageData={pageData}
+     setPageData={setPageData}
+     listingTitle={listingTitle}
+     title={title}
+     onSubmitCallback={onSubmitCallback}
+     showListingImage={showListingImage}
+     {...props}
+   />
  ) : processName && !isInquiryProcess && !speculateTransactionInProgress ? (
    <CheckoutPageWithPayment
      config={config}
    ...
```

To use _CheckoutPageWithoutPayment_, we also need to make these changes
to existing components:

- Export a _processCheckoutWithoutPayment_ function from
  _src/containers/CheckoutPage/CheckoutPageTransactionHelpers.js_

<FileTree>
  <FileTree.Folder name="src" defaultOpen>
    <FileTree.Folder name="containers" defaultOpen>
      <FileTree.Folder name="CheckoutPage" defaultOpen>
        <FileTree.File name="CheckoutPageTransactionHelpers.js" />
      </FileTree.Folder>
    </FileTree.Folder>
  </FileTree.Folder>
</FileTree>

```jsx filename="CheckoutPageTransactionHelpers.js"
export const processCheckoutWithoutPayment = (
  orderParams,
  extraParams
) => {
  const {
    message,
    onInitiateOrder,
    onSendMessage,
    pageData,
    process,
    setPageData,
    sessionStorageKey,
  } = extraParams;

  const storedTx = ensureTransaction(pageData.transaction);

  const processAlias =
    pageData?.listing?.attributes?.publicData?.transactionProcessAlias;

  ////////////////////////////////////////////////
  // Step 1: initiate order                     //
  // by requesting booking from Marketplace API //
  ////////////////////////////////////////////////
  const fnRequest = (fnParams) => {
    // fnParams should be { listingId, deliveryMethod, quantity?, bookingDates?, protectedData }

    const requestTransition =
      storedTx?.attributes?.lastTransition ===
      process.transitions.INQUIRE
        ? // =====================
          // Double check that these transition names match the
          // transition names in your transaction process!
          // =====================
          process.transitions.REQUEST_PAYMENT_AFTER_INQUIRY
        : process.transitions.REQUEST_PAYMENT;
    const isPrivileged = process.isPrivileged(requestTransition);

    const orderPromise = onInitiateOrder(
      fnParams,
      processAlias,
      storedTx.id,
      requestTransition,
      isPrivileged
    );

    orderPromise.then((order) => {
      // Store the returned transaction (order)
      persistTransaction(
        order,
        pageData,
        storeData,
        setPageData,
        sessionStorageKey
      );
    });

    return orderPromise;
  };

  //////////////////////////////////
  // Step 2: send initial message //
  //////////////////////////////////
  const fnSendMessage = (fnParams) => {
    const orderId = fnParams?.id;
    return onSendMessage({ id: orderId, message });
  };

  /////////////////////////////////
  // Call each step in sequence //
  ////////////////////////////////

  return fnRequest(orderParams).then((res) =>
    fnSendMessage({ ...res })
  );
};
```

- Import and use _loadInitialData_ instead of
  _loadInitialDataForStripePayments_ in _CheckoutPage.js_.

<FileTree>
  <FileTree.Folder name="src" defaultOpen>
    <FileTree.Folder name="containers" defaultOpen>
      <FileTree.Folder name="CheckoutPage" defaultOpen>
        <FileTree.File name="CheckoutPage.js" />
      </FileTree.Folder>
    </FileTree.Folder>
  </FileTree.Folder>
</FileTree>

```jsx
if (getProcessName(data) !== INQUIRY_PROCESS_NAME) {
  // Fetch speculateTransition for transactions that include bookings or purchases
  loadInitialData({
    pageData: data || {},
    fetchSpeculatedTransaction,
    config,
  });
}
```

### Hide or remove Stripe related pages

If you are not using Stripe at all, you should remove or at least hide
the pages that are meant for managing the information saved to Stripe.
These pages are
[StripePayoutPage](https://github.com/sharetribe/web-template/tree/main/src/containers/StripePayoutPage)
and
[PaymentMethodsPage](https://github.com/sharetribe/web-template/tree/main/src/containers/PaymentMethodsPage).
Both of these pages are accessible through the account settings so we
want to hide them from both navigation component and route
configuration.

To hide the pages from account settings, modify the
`LayoutWrapperAccountSettingsSideNav` component:

<FileTree>
  <FileTree.Folder name="src" defaultOpen>
    <FileTree.Folder name="components" defaultOpen>
      <FileTree.Folder name="LayoutComposer" defaultOpen>
        <FileTree.Folder name="LayoutSideNavigation" defaultOpen>
          <FileTree.File name="LayoutWrapperAccountSettingsSideNav.js" />
        </FileTree.Folder>
      </FileTree.Folder>
    </FileTree.Folder>
  </FileTree.Folder>
</FileTree>

```diff filename="LayoutWrapperAccountSettingsSideNav.js"
- const { currentPage, showPaymentMethods, showPayoutDetails } = accountSettingsNavProps;
+ const { currentPage } = accountSettingsNavProps;

- const payoutDetailsMaybe = showPayoutDetails
-   ? [
-       {
-         text: <FormattedMessage id="LayoutWrapperAccountSettingsSideNav.paymentsTabTitle" />,
-         selected: currentPage === 'StripePayoutPage',
-         id: 'StripePayoutPageTab',
-         linkProps: {
-           name: 'StripePayoutPage',
-         },
-       },
-     ]
-   : [];
+ const payoutDetailsMaybe = [];

- const paymentMethodsMaybe = showPaymentMethods
-   ? [
-       {
-         text: (
-           <FormattedMessage id="LayoutWrapperAccountSettingsSideNav.paymentMethodsTabTitle" />
-         ),
-         selected: currentPage === 'PaymentMethodsPage',
-         id: 'PaymentMethodsPageTab',
-         linkProps: {
-           name: 'PaymentMethodsPage',
-         },
-       },
-     ]
-   : [];
+  const paymentMethodsMaybe = [];
```

In `routeConfiguration.js`, remove references to `StripePayoutPage` and
`PaymentMethodsPage`.

<FileTree>
  <FileTree.Folder name="src" defaultOpen>
    <FileTree.Folder name="routing" defaultOpen>
      <FileTree.File name="routeConfiguration.js" />
    </FileTree.Folder>
  </FileTree.Folder>
</FileTree>

```diff filename="routeConfiguration.js"
-export const ACCOUNT_SETTINGS_PAGES = [
-  'ContactDetailsPage',
-  'PasswordChangePage',
-  'StripePayoutPage',
-  'PaymentMethodsPage',
-];
+export const ACCOUNT_SETTINGS_PAGES = ['ContactDetailsPage', 'PasswordChangePage'];

return [
  ...
-  {
-     path: '/account/payments',
-     name: 'StripePayoutPage',
-     auth: true,
-     authPage: 'LoginPage',
-     component: StripePayoutPage,
-     loadData: pageDataLoadingAPI.StripePayoutPage.loadData,
-   },
-   {
-     path: '/account/payments/:returnURLType',
-     name: 'StripePayoutOnboardingPage',
-     auth: true,
-     authPage: 'LoginPage',
-     component: StripePayoutPage,
-     loadData: pageDataLoadingAPI.StripePayoutPage.loadData,
-   },
-   {
-     path: '/account/payment-methods',
-     name: 'PaymentMethodsPage',
-     auth: true,
-     authPage: 'LoginPage',
-     component: PaymentMethodsPage,
-     loadData: pageDataLoadingAPI.PaymentMethodsPage.loadData,
-   },

```

Finally, you need to remove StripePayoutPage from the
ModalMissingInformation.js component whitelist.

<FileTree>
  <FileTree.Folder name="src" defaultOpen>
    <FileTree.Folder name="components" defaultOpen>
      <FileTree.Folder name="ModalMissingInformation" defaultOpen>
        <FileTree.File name="ModalMissingInformation.js" />
      </FileTree.Folder>
    </FileTree.Folder>
  </FileTree.Folder>
</FileTree>

```diff filename="ModalMissingInformation.js"
const MISSING_INFORMATION_MODAL_WHITELIST = [
  'LoginPage',
  'SignupPage',
  'ContactDetailsPage',
  'EmailVerificationPage',
  'PasswordResetPage',
- 'StripePayoutPage',
];
```

### Extra: Removing unused exports

This is not a mandatory step to do but if you want to clean up the code
you can go through the `components/index.js` and `containers/index.js`,
and remove the Stripe components. After this, you should go through the
whole codebase and remove all the references to these components. We
have tried to follow the naming pattern where Stripe related components
have `Stripe` in their name but there are a couple of exceptions like
`PaymentMethodsPage`. All these components should be removed also from
`examples.js`.

Stripe related components:

- StripeBankAccountTokenInputField
- StripeConnectAccountStatusBox
- StripePaymentAddress
- StripePayoutPage
- PaymentMethodsPage
- PaymentMethodsForm
- StripePaymentForm
- StripeConnectAccountForm

You can also remove Stripe script form
[public/index.html](https://github.com/sharetribe/web-template/blob/main/public/index.html#L171).

</Steps>

## Removing payments

If you want to remove payments completely from your marketplace, there
are even more things to consider. Again it depends a lot on your
use-case what kind of changes are needed. If you e.g. want to add a
transaction process with free bookings or purchases, you need to build
the conditional logic for showing pricing components when needed and
hiding them when not. If you want to build the marketplace completely
without payments, you most likely want to hide all the references to
listing price.

### More changes to the transaction process

Remove the actions related to payments, e.g.
`:action/privileged-set-line-items` and `:action/calculate-full-refund`
in the default processes. Read more about actions in the
[transaction process actions reference article.](/references/transaction-process-actions/)
Remember to also update email templates that contain pricing
information.

### Edit API calls in client app's server

You will need to edit the API calls in your client app's server. If
there are no payments used, there is most likely no need for calculating
line items, so we can remove `transactionLineItems` function calls from
API endpoints. Depending on your use case, you may or may not want to
use the privileged transitions at all. However, in case you are updating
e.g. transaction protected data, it is a good practice to do that safely
in the template's backend.

### Other code changes

Especially if you are removing the payment completely from your
marketplace, you should also go through all these pages to hide or
remove the parts related to payments.

- ListingPage, CheckoutPage, TransactionPage: Remove or hide
  `OrderBreakdown` component when the transaction is free
- EditListingPage: remove pricing tab from `EditListingWizard`
- SearchPage: remove price filter & edit `ListingCard` so that it
  doesn't show the listing price
