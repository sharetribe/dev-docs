---
title: Extend listing data in Sharetribe Web Template
sidebarTitle: Extend listing data
description:
  This guide describes how to use extended data to expand the listing
  data model in Sharetribe Web Template.
---

import { Callout, FileTree } from 'nextra/components';

# Extend listing data in Sharetribe Web Template

This guide shows you a code-based approach to expanding the listing data
model in your marketplace. We'll have a look on how the listing can be
configured so that the data gets added, and how it can then be presented
and used to filter searches.

Adding new attributes to the data model relies on
[extended data](/references/extended-data/). In Sharetribe Web Template,
top-level listing extended data is configured in the
[configListing.js](https://github.com/sharetribe/web-template/blob/main/src/config/configListing.js)
file.

<FileTree>
  <FileTree.Folder name="src" defaultOpen>
    <FileTree.Folder name="config" defaultOpen>
      <FileTree.File name="configListing.js" />
    </FileTree.Folder>
  </FileTree.Folder>
</FileTree>

<Callout type="info">

Settings configured in local configurations files are overridden by any
fetched via the Asset Delivery API. You can refer to
[this article](/template/configuration/hosted-and-local-configurations/)
to modify the way your template merges local and hosted configurations.

</Callout>

Configuring the listing data this way allows you to

- declare the attribute and its possible values
- show the attribute selection inputs in the listing editing wizard
- optionally show the attribute values on the listing page and
- optionally use the attribute as a search filter.

There are a handful of use cases that are possible to achieve with
code-based configurations but not Console-based ones. These include
determining the attribute's search mode to **has_any**, and setting a
default value for the attribute's search schema.

If you want to configure a complex extended data attribute, e.g. a JSON
object, it is good to note that Sharetribe only allows searching and
filtering top-level attributes. In other words, complex attributes
cannot be used to filter listings. However, they can be useful in
storing other relevant listing data.

For a more complex attribute, you will need to add extended data
directly to a listing. You will also need to make custom changes to your
listing page, if you want to show the attribute there.

## Define a has_any multi-enum field for listings

In this article, we will extend top-level data using
**configListing.js** to use a **has_any** search pattern.

When configuring a multi-enum field in Console, the search is always in
**has_all** mode – selecting two options returns listings with both of
those attributes selected. In the Marketplace API, it is also possible
to search with **has_any** mode – selecting two options returns listings
with either of the options.

Let's extend the default bike related listing data by adding an
attribute 'accessories' to show what accessories are included. The full
configuration looks like this:

```jsx filename="configListing.js"
  {
    key: 'accessories',
    scope: 'public',
    schemaType: 'multi-enum',
    enumOptions: [
      { option: 'bell', label: 'Bell' },
      { option: 'lights', label: 'Lights' },
      { option: 'lock', label: 'Lock' },
      { option: 'mudguard', label: 'Mudguard' },
    ],
    saveConfig: {
      label: 'Accessories',
      placeholderMessage: 'Select an option…',
      isRequired: false,
    },
    filterConfig: {
      indexForSearch: true,
      label: 'Accessories',
      searchMode: 'has_any',
      group: 'secondary',
    },
    showConfig: {
      label: 'Accessories',
    },
  },
```

### Declare the attribute and its possible values

Extended data attributes in the `configListing.js` file need to be
defined, at minimum, by **key**, by **scope**, and by **schemaType**.

```jsx filename="configListing.js"
key: 'accessories',
scope: 'public',
schemaType: 'multi-enum',
enumOptions: [
  { option: 'bell', label: 'Bell' },
  { option: 'lights', label: 'Lights' },
  { option: 'lock', label: 'Lock' },
  { option: 'mudguard', label: 'Mudguard' },
],
// If you have multiple listing types, you can define the types that should have this field
// listingTypeConfig: {
//   limitToListingTypeIds: true,
//   listingTypeIds: [
//     'selling'
//   ]
// }
```

This attribute is defined as **public**, so it will be saved into the
listing as **publicData.accessories**. The **schemaType** attribute
determines the shape of the data being saved:

- **enum** attributes are saved as a single string value from a list of
  predefined options
- **multi-enum** attributes are saved as an array of string values from
  a list of predefined options
- **boolean** attributes are saved as **true** or **false** boolean
  values
- **long** attributes are saved as long i.e. as an 8-byte whole number
- **text** attributes are saved as a single text entry

If the schema type is **enum** or **multi-enum**, you will need to
define an array of **enumOptions** for the attribute. This allows the
listing editing wizard to show the options when your user creates the
listing, and it also provides the options for the search filters.

If your marketplace uses multiple listing types, you can optionally
define an attribute **listingTypeConfig**. This object should have two
attributes:

- **limitToListingTypeIds**, a boolean attribute determining whether to
  limit the attribute to specific listing types
- **listingTypeIds** an array of the listing types that should have this
  field. If this attribute is not set, then the field is included for
  all listing types.

<Callout type="info">

Note that if you limit a listing field to specific listing types, the
filters for that field will only show up on the search page if the
listing type in question is selected as a filtering parameter. If you
want a filter to always show up on the search page, don't limit it to
listing types.

</Callout>

### Configure the listing detail editing page

The `EditListingDetailsPanel` is configured to show specific inputs for
specific schema types. This means that you only need to configure how
the attribute shows up in the panel.

You can separately determine the label for edit listing page and the
other contexts where the attribute shows up. You can also set the
attribute as required, and determine the error message to show if the
attribute is missing.

```jsx filename="configListing.js"
saveConfig: {
  label: 'Accessories',
  placeholderMessage: 'Select an option…',
  isRequired: false,
},
```

### Configure search

Top-level attributes can be set as searchable, but you might have
listing attributes you do not want to use for filtering listings. For
instance, you may have private data text fields that the listing author
can use for listing-specific notes.

For searchable attributes, you will need to include the **filterConfig**
attribute to your listing configuration. In addition, you will need to
[define a search schema](/how-to/search/manage-search-schemas-with-sharetribe-cli/).
Make sure you define the search schema **type** according to the listing
configuration **schemaType**.

For multi-enum attributes, you can use **searchMode** to define whether
you want to show

- listings with all the query attributes (_has_all_), or
- listings with any of the query attributes(_has_any_).

If searchMode is not defined, or if you define a listing field in
Console, the default is _has_all_. To define a multi-enum listing field
with _has_any_ search logic, you will need to define the field in your
local code.

```jsx filename="configListing.js"
filterConfig: {
  indexForSearch: true,
  label: 'Accessories',
  searchMode: 'has_any',
  group: 'secondary',
},
```

When you define your listing field in code, you will need to
[add a search schema](/how-to/search/manage-search-schemas-with-sharetribe-cli/#adding-listing-search-schemas)
for the attribute to enable it for search.

### Configure the listing page

The configuration for showing top-level extended data on the listing
page is straightforward. In addition to the label, you can determine
whether to show specific attribute values on the listing page.

By default, all listing config attributes with a **showConfig.label**
are shown on the listing page, but by setting **isDetail** to **false**
on an attribute with schema type _enum_, _long_, or _boolean_, you can
hide the attribute from the Details section on the listing page.

```jsx filename="configListing.js"
showConfig: {
  label: 'Accessories',
},
```

And that is it! With this configuration, the attribute can be added to
the listing, used for search, and shown on the listing page.

<Callout type="info">

If there are existing listings, they don't get an update before their
extended data is updated by the listing author. (Operator can also do
this one-by-one through Console or through Integration API.) So, you
should assume that there are listings without these new extended data
fields and, therefore, there should be some safeguards against undefined
values.

</Callout>
